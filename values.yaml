# Valkey Helm Chart - Minimal Configuration

# Deployment mode: standalone or sentinel
architecture: standalone

global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Cluster domain for service discovery
clusterDomain: cluster.local

# Valkey image configuration
image:
  registry: docker.io
  repository: valkey/valkey
  tag: "8.1.3"
  pullPolicy: IfNotPresent

# Common configuration
nameOverride: ""
fullnameOverride: ""

# Authentication configuration
auth:
  enabled: false
  password: ""
  existingSecret: ""
  existingSecretPasswordKey: "password"

# Network Policy
networkPolicy:
  enabled: false
  allowExternal: true
  ingressNSMatchLabels: {}
  ingressNSPodMatchLabels: {}

# RBAC configuration
rbac:
  create: false

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod Security Context
podSecurityContext:
  fsGroup: 999
  runAsUser: 999
  runAsGroup: 999

# Security Context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 999

# Common annotations and labels
commonAnnotations: {}
commonLabels: {}

# Standalone Configuration
standalone:
  replicaCount: 1

  resources:
    limits:
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

  nodeSelector: {}
  tolerations: []
  affinity: {}

  persistence:
    enabled: true
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    size: 8Gi
    annotations: {}

  service:
    type: ClusterIP
    port: 6379
    targetPort: valkey
    annotations: {}

  configuration: |-
    # Valkey configuration
    bind 0.0.0.0
    port 6379
    tcp-backlog 511
    timeout 0
    tcp-keepalive 300

    # Memory configuration
    maxmemory-policy allkeys-lru

    # Persistence
    save 900 1
    save 300 10
    save 60 10000

    # Logging
    loglevel notice

    # Security
    protected-mode no

# Sentinel Configuration
sentinel:
  enabled: false
  replicaCount: 3
  quorum: 2

# Master configuration for sentinel mode
master:
  replicaCount: 1
  resources:
    limits:
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  persistence:
    enabled: true
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    size: 8Gi
  service:
    type: ClusterIP
    port: 6379
    targetPort: valkey
  configuration: |-
    # Valkey master configuration
    bind 0.0.0.0
    port 6379
    tcp-backlog 511
    timeout 0
    tcp-keepalive 300
    maxmemory-policy allkeys-lru
    save 900 1
    save 300 10
    save 60 10000
    loglevel notice
    protected-mode no

# Replica configuration for sentinel mode
replica:
  replicaCount: 2
  resources:
    limits:
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  persistence:
    enabled: true
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    size: 8Gi
  service:
    type: ClusterIP
    port: 6379
    targetPort: valkey
  configuration: |-
    # Valkey replica configuration
    bind 0.0.0.0
    port 6379
    tcp-backlog 511
    timeout 0
    tcp-keepalive 300
    maxmemory-policy allkeys-lru
    save ""
    loglevel notice
    protected-mode no

# Metrics configuration
metrics:
  enabled: false
  image:
    registry: docker.io
    repository: oliver006/redis_exporter
    tag: "v1.45.0"
    pullPolicy: IfNotPresent
  resources:
    limits:
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  service:
    type: ClusterIP
    port: 9121
    annotations: {}
    nodePort: ""
    loadBalancerIP: ""
    loadBalancerSourceRanges: []
    clusterIP: ""

# Init containers for volume permissions
volumePermissions:
  enabled: false
  image:
    registry: docker.io
    repository: alpine
    tag: "3.19"
    pullPolicy: IfNotPresent

# Sysctls configuration
sysctls:
  enabled: false

# Additional configuration options
existingConfigmap: ""

# Extra environment variables
extraEnvVars: []

# Extra volumes
extraVolumes: []

# Extra volume mounts
extraVolumeMounts: []

# TLS Configuration
tls:
  enabled: false

# Extra resources to deploy
extraDeploy: []

# External service configuration (can be configured via service type)
# Use standalone.service.type: LoadBalancer for external access

# Service Binding configuration
serviceBinding:
  enabled: false